// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model UserTable {
  id    String @id
  email String @unique

  name     String
  password String

  role String @default("ORG") // ADMIN || ORG

  status String @default("ACTIVE") // ACTIVE || INACTIVE

  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  PollTable PollTable[] @relation(name: "FK_Poll_User")

  @@index([status])
}

model RefreshTokenTableTable {
  id        String   @id
  familyId  String
  userId    String
  token     String
  createdAt DateTime
  expiresAt DateTime
  status    String   @default("GRANTED") // GRANTED || REJECTED

  @@index([familyId])
  @@map("RefreshTokens")
}

model PollTable {
  id     String @id
  userId String

  name      String
  createdAt DateTime
  expiresAt DateTime

  status String @default("ACTIVE") // ACTIVE || INACTIVE

  User          UserTable           @relation(name: "FK_Poll_User", fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  PollQuestions PollQuestionTable[] @relation(name: "FK_PollQuestion_Poll")

  @@unique([userId, id])
}

model PollQuestionTable {
  id     String @id
  userId String
  pollId String

  name String

  Poll                PollTable                 @relation(name: "FK_PollQuestion_Poll", fields: [userId, pollId], references: [userId, id], onDelete: NoAction, onUpdate: NoAction)
  PollQuestionAnswers PollQuestionAnswerTable[] @relation(name: "FK_PollQuestionAnswer_PollQuestion")

  @@unique([userId, id])
}

model PollQuestionAnswerTable {
  id             String @id
  pollQuestionId String
  macAddress     String

  PollQuestion PollQuestionTable @relation(name: "FK_PollQuestionAnswer_PollQuestion", fields: [pollQuestionId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([macAddress])
}
